<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">

var Monad = function(){
    var instance = {};
    instance.stack = [];
    
    instance.bind = function(func){
        instance.stack.push(func);
        return instance;
    }

    instance.pass = function(target){
        //target can either return something, or be a Monad itself
        if(typeof target == "function"){
            return target(Monad());
        }else{
            return target;
        }
    }

    instance.render = function(f){
        //if a function is passed, bind it
        //to the stack and render it within context

        if(typeof f == "function"){
           return instance.bind(f).render();
        }else{
            return instance.stack.map(function(item){
                       return instance.pass(item);
                   }).join(', ');
        }
    }

    //######################################

    instance.nest = function(func){
        return instance.bind(function(m){
            console.log("nesting: " + func);
            return Monad().render(func);
        });
    }

    instance.ready = function(){
        return instance.bind(function(m){
            return "ready";
        });
    }


    instance.set = function(){
        return instance.bind(function(m){
            return "set";
        });
    }

    instance.go = function(){
        return instance.bind(function(m){
            return "go";
        });
    }

    return instance;
}
 
var done = Monad().ready().nest(function(m){ 
                                 return m.ready().set().render()} )
                            .set().go();

console.log(done.render());
</script>
</head>
<body>
<h2>Example 1</h2>
<div id="example1"></div>
<h2>Example 2</h2>
<div id="example2"></div>
<h2>Example 3</h2>
<div id="example3"></div>
</body>
</html>
