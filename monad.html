<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript">

var Monad = function(){
    var instance = {};

    instance.fs = []; // Stack of functions
    instance.rs = []; // Stack of return values
    
    instance.bind = function(func){
        instance.fs.push(func);
        return instance;
    }

    instance.pass = function(target){
        if(typeof target == "function"){
            target(instance);
        }else{
            instance.rs.push(target);
        }
    }

    instance.render = function(f){
        if(f){
            instance.fs[instance.fs.length] = f;
        }

        var current;
        while(instance.fs.length > 0){
            current = instance.fs.shift();
            instance.pass(current);
        }

        return instance.rs.join(', ');
    }

    //######################################

    instance.nest = function(func){
        return instance.bind(function(mn){
            mn.pass(Monad().render(func));
        });
    }

    instance.ready = function(){
        return instance.bind(function(mn){
            mn.pass("ready");
        });
    }

    instance.set = function(){
        return instance.bind(function(mn){
            mn.pass("set");
        });
    }

    instance.go = function(){
        return instance.bind(function(mn){
            mn.pass("go");
        });
    }

    return instance;
}
 
var exampleA = Monad().render(function(mn){ mn.ready().set()});
var exampleB = Monad().ready().set().nest(function(mn){ mn.ready().set()}).go();
console.log("result A: " + exampleA);
console.log("result B: " + exampleB.render());

</script>
</head>
<body>
<h2>Example 1</h2>
<div id="example1"></div>
<h2>Example 2</h2>
<div id="example2"></div>
<h2>Example 3</h2>
<div id="example3"></div>
</body>
</html>
