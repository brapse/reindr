<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<script src="src/reindeer.js" type="text/javascript"></script>
<style type="text/css">
    #results div {
        padding: 12px;
        background: #ccc;
        border: 1px solid black;
        margin-bottom: 8px;
    }

    #results div.pass {
        background: #C4FFA0;
        border-color: #4ECB00;
        color: #4ECB00;
        font-size: 14px;
        font-weight: bold;
    }

    #results div.fail {
        background: #FFADAD;
        border-color: #FF0000;
        color: #FF0000;
        font-size: 14px;
        font-weight: bold;
    }
</style>
<script type="text/javascript">

    var pass = function(desc) {
        var result = "<div class=\"pass\">";
        result += "<span>Pass: " + desc + "</span>";
        result += "</div>";
        $("#results").append(result);
    };

    var fail = function(desc, msg) {
        var result = $("<div>").addClass("fail");
        var desc   = $("<span>").text("Failure: " + desc);
        var msg    = $("<span>").text(msg);
        $("#results").append(result.append(msg).append(msg));
    };

    var assert_renders = function(rd, markup, desc){
        //same markup without whitespaces
        if(rd.replace(/\s/g,'') == markup.replace(/\s/g,'')){
            pass(desc);
        }else{
            fail(desc, "expected: " + rd + " to be: " + markup);
        }
    };

$(function(){
  // basics
  assert_renders(Reindeer().text("example1").render(), "example1", "Simple text");
  assert_renders(Reindeer().span().text("Example2").render(), "<span>Example2</span>", "Span tag");
  assert_renders(Reindeer().div().span().text("Example3").render(), "<div><span>Example3</span></div>", "Span tag nested in a div");

  //attributes
  assert_renders(Reindeer().span({class: "myClass"}).text("Example4").render(), "<span class=\"myClass\">Example4</span>", "Tag with attributes");

  //Filling
  var col = ["one", "two"];
  fill_func = function(collection, rd){
    collection.each(function(el){
        return rd.span().text("nested: " + el);
    });
  }

  // Support for render based filling. Reindeer().span().render("foo"); # => <span>foo</span>
  var filled  = Reindeer().div().collect(col, function(rd, e){ return rd.span().text("item: " + e).render()}).render();
  var expected_html = "<div><span>item: one</span><span>item: two</span></div>";

  assert_renders(filled, expected_html, "Reindeer with filling");

  //support for insertion points
  Reindeer("target1").span().text("target1").render();
  assert_renders(document.getElementById("target1").innerHTML, "<span>target1</span>", "insert rendering into a target");

  //Support for chained attributes buidling (A la jquery);
  /* PENDING
  PENDING */   
});
</script>
</head>
<body>
    <h1>Reindeer tests</h1>
    <div id="results">
    </div>
    <div id="target1" style="visibility: hidden"></div>
</body>
</html>
