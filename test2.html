<!DOCTYPE html
PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js" type="text/javascript"></script>
<!--<script src="src/reindr.js" type="text/javascript"></script>-->
<style type="text/css">
    #results div {
        padding: 12px;
        background: #ccc;
        border: 1px solid black;
        margin-bottom: 8px;
    }

    #results div.pass {
        background: #C4FFA0;
        border-color: #4ECB00;
        color: #4ECB00;
        font-size: 14px;
        font-weight: bold;
    }

    #results div.fail {
        background: #FFADAD;
        border-color: #FF0000;
        color: #FF0000;
        font-size: 14px;
        font-weight: bold;
    }
</style>
<script type="text/javascript">

    var pass = function(desc) {
        var result = "<div class=\"pass\">";
        result += "<span>Pass: " + desc + "</span>";
        result += "</div>";
        $("#results").append(result);
    };

    var fail = function(desc, msg) {
        var result = $("<div>").addClass("fail");
        var desc   = $("<span>").text("Failure: " + desc);
        var msg    = $("<span>").text(msg);
        $("#results").append(result.append(msg).append(msg));
    };

    var assert_renders = function(rd, markup, desc){
        //same markup without whitespaces
        if(rd.replace(/\s/g,'') == markup.replace(/\s/g,'')){
            pass(desc);
        }else{
            fail(desc, "expected: " + rd + " to be: " + markup);
        }
    };


var html = function(t_func){
    var t = {};

    var tag_function = function(tag){
        return function(attrs, content){
            var tag_attributes = [];
            if(typeof(attrs) == 'object'){
                for(var prop in attrs){
                    if(attrs.hasOwnProperty(prop)){
                        tag_attributes.push(prop + '="' + attrs[prop] + '"');
                    }
                }
            }

            return '<' + tag + ' ' + tag_attributes.join(' ') + '>' + content + '</' +tag + '>'
        }
    };

    var body = t_func.toString().replace(/\n/g, "").match(/{(.*)}/)[1];

         var supported_tags = ['div', 'p', 'span', 'a', 'ul', 'li', 'table', 'tr', 'td'];
    var wrapper = new Function('div', 'p', 'span', 'a', 'ul', 'li', 'table', 'tr', 'td', body);

    var tag_functions = supported_tags.map(function(tag){
                return tag_function(tag);
            });

    var stack = wrapper.apply(null, tag_functions);

    var render = function(node){
        console.log('rendering');
        if(typeof(node) == "undefined" || !node.length || node.length == 0){
            return '';
        }else if(typeof(node) == "string"){
            return node;
        }else if(typeof(node[0]) == "function"){
            //an element with children
            var tag = node.shift();
            return tag(render(node));
        }else{
            //children
            return node.map(function(el){ return render(el) }).join("\n");
        }
    }

    return render(stack);
};

var example1 = html(function(){
    return [span, "lol"];
});

var example2 = html(function(){
    return [span, [a, "myhouse"]];
});

var example3 = html(function(){
    return [span({class: "droid"}), "Robots"];
});

var example4 = html(function(){
  return [ul,
            [li, "ichi"],
            [li, "ni"],
            [li, "san"],
         ];
});

</script>
</head>
<body>
    <h1>Reindr tests</h1>
    <div id="results">
    </div>
    <div id="target1" style="visibility: hidden"></div>
</body>
</html>
